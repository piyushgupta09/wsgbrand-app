"use strict";(self["webpackChunkwsgbrand_app_v1"]=self["webpackChunkwsgbrand_app_v1"]||[]).push([[68],{7068:function(t,e,a){a.d(e,{c:function(){return Tt}});var s=a(4108),i=a(9096),n=a(7764);const o={class:"mt-2"},r={class:"flex-grow-1 overflow-auto reversed-list"},d={key:0,class:"list-group list-group-flush m-2"},l={class:"mt-auto"};function c(t,e,a,c,h,g){const m=(0,s.E1)("ChatFilters"),u=(0,s.E1)("ChatCard"),p=(0,s.E1)("ChatDetails"),f=(0,s.E1)("ChatActions");return h.ledger?((0,s.Wz)(),(0,s.An)("div",{key:0,class:"font-title d-flex flex-column vh-100",style:(0,i.MN)({"background-image":"url("+h.backdrop+")","background-position":"center","background-repeat":"no-repeat","background-size":"cover"})},[(0,s.QD)("div",o,[(0,s.K2)(m,{title:h.title,filters:h.filters,hasMore:h.hasMore,ledgerSid:h.ledgerSid,onLoadMoreChats:g.loadMore,onChatFilterUpdated:g.handleFiltersChange},null,8,["title","filters","hasMore","ledgerSid","onLoadMoreChats","onChatFilterUpdated"])]),(0,s.QD)("div",r,[Object.keys(g.filteredChats).length?((0,s.Wz)(),(0,s.An)("ul",d,[(0,s.K2)(n.Q9,{name:"slide"},{default:(0,s.Ql)((()=>[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(g.filteredChats,((t,e)=>((0,s.Wz)(),(0,s.An)("li",{class:"list-group-item rounded-0 p-0 border-0 bg-transparent mb-2",key:e},[(0,s.K2)(u,{chat:t,chatIndex:e,opacity:h.filters.opacity},null,8,["chat","chatIndex","opacity"])])))),128))])),_:1})])):(0,s.g1)("",!0),(0,s.K2)(p,{chats:g.filteredChats},null,8,["chats"])]),(0,s.QD)("div",l,[(0,s.K2)(f,{ledgerSid:h.ledgerSid,onUpdateChats:g.handleNewChat},null,8,["ledgerSid","onUpdateChats"])])],4)):(0,s.g1)("",!0)}a(3248);var h=a(6376);const g=["data-bs-chat-id"],m={class:"smaller text-bg-dark ps-3 text-capitalize rounded-pill"},u=(0,s.QD)("i",{class:"bi-record-fill text-warning pe-2"},null,-1),p={key:0},f={key:1},b=["src"],y={key:2},v=["src"],D={key:3},x=["download","href"],C={class:"ms-2 text-muted smaller"},w={class:"smaller text-bg-dark px-3 text-capitalize rounded-pill"},A={key:0},Q={key:1},M=["src"],k={key:2},W=["src"],z={key:3},S=["download","href"],R={class:"ms-2 text-muted smaller"};function L(t,e,a,n,o,r){return a.chat&&a.chat.items&&a.chat.items.length?((0,s.Wz)(),(0,s.An)("div",{key:0,class:(0,i.WN)(["d-flex flex-column text-right p-1 rounded-3",{"align-items-end ms-auto":a.chat.myChat,"align-items-start":!a.chat.myChat,[r.chatOpacity(a.chat.myChat)]:!0}]),style:(0,i.MN)([{"max-width":"90%",width:"fit-content"},{"border-bottom-left-radius":a.chat.myChat?"":"0 !important","border-bottom-right-radius":a.chat.myChat?"0 !important":""}]),"data-bs-chat-id":a.chat.id,"aria-controls":"ledgerChatInfoModal","data-bs-toggle":"offcanvas","data-bs-target":"#ledgerChatInfoModal"},[(0,s.QD)("div",m,[(0,s.mY)((0,i.WA)(a.chat.sender_name)+" | "+(0,i.WA)(a.chat.model)+" ",1),u]),(0,s.QD)("div",{class:(0,i.WN)(["p-1 rounded",{"text-end":a.chat.myChat,"text-start":!a.chat.myChat}])},["text"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",p,(0,i.WA)(a.chat.content),1)):(0,s.g1)("",!0),"audio"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",f,[(0,s.QD)("audio",{ref:`audioPlayer-${a.chatIndex}`,src:a.chat.content,controls:""},null,8,b)])):(0,s.g1)("",!0),"image"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",y,[(0,s.QD)("img",{src:a.chat.content,style:{height:"250px","object-fit":"contain"}},null,8,v)])):(0,s.g1)("",!0),"pdf"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",D,[(0,s.QD)("a",{download:a.chat.content,class:"btn btn-dark",href:a.chat.content},"Download Pdf",8,x)])):(0,s.g1)("",!0)],2),(0,s.QD)("div",C,(0,i.WA)(r.formatMessageTime(a.chat.delivered_at)),1)],14,g)):((0,s.Wz)(),(0,s.An)("div",{key:1,class:(0,i.WN)(["d-flex flex-column text-right p-1 rounded-3",{"align-items-end ms-auto":a.chat.myChat,"align-items-start":!a.chat.myChat,[r.chatOpacity(a.chat.myChat)]:!0}]),style:(0,i.MN)([{"max-width":"90%",width:"fit-content"},{"border-bottom-left-radius":a.chat.myChat?"":"0 !important","border-bottom-right-radius":a.chat.myChat?"0 !important":""}])},[(0,s.QD)("div",w,(0,i.WA)(a.chat.sender_name)+" | "+(0,i.WA)(a.chat.model),1),(0,s.QD)("div",{class:(0,i.WN)(["p-1 rounded",{"text-end":a.chat.myChat,"text-start":!a.chat.myChat}])},["text"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",A,(0,i.WA)(a.chat.content),1)):(0,s.g1)("",!0),"audio"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",Q,[(0,s.QD)("audio",{ref:`audioPlayer-${a.chatIndex}`,src:a.chat.content,controls:""},null,8,M)])):(0,s.g1)("",!0),"image"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",k,[(0,s.QD)("img",{src:a.chat.content,style:{height:"250px","object-fit":"contain"}},null,8,W)])):(0,s.g1)("",!0),"pdf"===a.chat.type?((0,s.Wz)(),(0,s.An)("span",z,[(0,s.QD)("a",{download:a.chat.content,class:"btn btn-dark",href:a.chat.content},"Download Pdf",8,S)])):(0,s.g1)("",!0)],2),(0,s.QD)("div",R,(0,i.WA)(r.formatMessageTime(a.chat.delivered_at)),1)],6))}var F={name:"ChatCard",props:{chat:{type:Object,default:()=>({})},chatIndex:{type:Number,default:0},opacity:{type:Boolean,default:!1}},methods:{chatOpacity(t){let e=this.opacity?"show":"hide";return t?"my-chat-"+e:"other-chat-"+e},formatMessageTime(t){const e={month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},a=new Date(t).toLocaleDateString("en-US",e);return a}}},I=a(4100);const _=(0,I.c)(F,[["render",L]]);var j=_;const $={class:"border-bottom bg-body-tertiary pe-2"},U={class:"navbar navbar-expand py-1"},O={class:"navbar-collapse d-flex align-items-center"},E={class:"d-flex align-items-center"},N=(0,s.QD)("i",{class:"bi bi-chevron-left"},null,-1),P={class:"fw-500 max-line-1"},T={class:"navbar-nav ms-auto align-items-center",style:{"min-width":"120px"}},B=(0,s.QD)("li",{class:"nav-item"},[(0,s.QD)("button",{class:"btn border-0","data-bs-toggle":"collapse","data-bs-target":"#offcanvasSearch","aria-expanded":"false","aria-controls":"offcanvasSearch"},[(0,s.QD)("i",{class:"bi bi-search"})])],-1),K={class:"nva-item"},H={key:0,class:"bi bi-eye"},q={key:1,class:"bi bi-eye-slash"},Y=(0,s.QD)("i",{class:"bi bi-arrow-clockwise"},null,-1),V=[Y],G={class:"collapse",id:"offcanvasSearch"},J={class:"form-floating mx-2 mb-2"},X=(0,s.QD)("label",{for:"floatingInput"},"Search by name or code",-1);function Z(t,e,a,o,r,d){const l=(0,s.E1)("router-link");return(0,s.Wz)(),(0,s.An)("div",$,[(0,s.QD)("nav",U,[(0,s.QD)("div",O,[(0,s.QD)("div",E,[(0,s.K2)(l,{class:"btn border-0 px-2",to:{name:d.myLedgerPage,params:{ledger:this.ledgerSid}}},{default:(0,s.Ql)((()=>[N])),_:1},8,["to"]),(0,s.QD)("span",P,(0,i.WA)(a.title),1)]),(0,s.QD)("ul",T,[B,(0,s.QD)("li",K,[(0,s.QD)("button",{type:"button",class:"btn border-0",onClick:e[0]||(e[0]=(...t)=>d.toggleChatOpacity&&d.toggleChatOpacity(...t))},[r.opacity?((0,s.Wz)(),(0,s.An)("i",H)):((0,s.Wz)(),(0,s.An)("i",q))]),(0,s.QD)("button",{class:(0,i.WN)(["btn border-0",{"text-muted":!a.hasMore,"text-primary":a.hasMore}]),onClick:e[1]||(e[1]=(...t)=>d.emitLoadMore&&d.emitLoadMore(...t))},V,2)])])])]),(0,s.QD)("div",G,[(0,s.QD)("div",J,[(0,s.wt)((0,s.QD)("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.search=t),type:"search",class:"form-control rounded-0",placeholder:"Search Stocks",onChange:e[3]||(e[3]=(...t)=>d.emitFilters&&d.emitFilters(...t))},null,544),[[n.Og,r.search,void 0,{lazy:!0}]]),X])])])}var tt={name:"ChatFilters",emits:["chat-filter-updated","load-more-chats"],props:{title:{type:String,default:"Ledger Chat"},ledgerSid:{type:String,default:""},filters:{type:Object,default:()=>({})},hasMore:{type:Boolean,default:!1}},data(){return{search:"",startDate:"",endDate:"",opacity:!0}},methods:{applyFilters(){this.$emit("chat-filter-updated",{search:this.search,start_date:this.startDate,end_date:this.endDate,opacity:this.opacity})},emitFilters(){this.applyFilters()},emitLoadMore(){this.hasMore&&this.$emit("load-more-chats")},capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)},toggleChatOpacity(){this.opacity=!this.opacity,this.applyFilters()}},computed:{myLedgerPage(){const t=this.$store.getters["authy/getPrefix"];return"brand"===t?"BrandProductLedger":"factory"===t?"FactoryLedgerDetail":`${this.capitalizeFirstLetter(t)}Dashboard`}}};const et=(0,I.c)(tt,[["render",Z]]);var at=et;const st={class:"offcanvas offcanvas-bottom h-50",tabindex:"-1",id:"ledgerChatInfoModal","aria-labelledby":"ledgerChatInfoModalLabel"},it={class:"offcanvas-header w-100 d-flex justify-content-between align-items-center bg-light border-bottom"},nt={class:"d-flex flex-column justify-content-start align-items-start"},ot={class:"text-uppercase",id:"ledgerChatInfoModalLabel"},rt={class:"fw-bold"},dt=(0,s.QD)("span",{class:"ps-2"},"Details",-1),lt=(0,s.QD)("button",{type:"button",class:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"},null,-1),ct={class:"offcanvas-body p-2"},ht={class:"row g-2"},gt={class:"d-flex border"},mt=["src"],ut={class:"d-flex flex-column justify-content-center ps-1"},pt={class:"lh-sm max-line-1"},ft={class:"lh-sm max-line-1"},bt={class:"lh-sm fw-bold"};function yt(t,e,a,n,o,r){return(0,s.Wz)(),(0,s.An)("div",st,[(0,s.QD)("div",it,[(0,s.QD)("div",nt,[(0,s.QD)("div",ot,[(0,s.QD)("span",rt,(0,i.WA)(o.chat.model),1),dt])]),lt]),(0,s.QD)("div",ct,[(0,s.QD)("div",ht,[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(o.chat.items,((t,e)=>((0,s.Wz)(),(0,s.An)("div",{class:"col-6",key:e},[(0,s.QD)("div",gt,[(0,s.QD)("img",{src:t.image,class:"w-60p"},null,8,mt),(0,s.QD)("div",ut,[(0,s.QD)("span",pt,(0,i.WA)(t.option),1),(0,s.QD)("span",ft,(0,i.WA)(t.range),1),(0,s.QD)("span",bt,(0,i.WA)(t.quantity)+" pcs",1)])])])))),128))])])])}var vt={name:"LedgerInfo",props:["chats"],data(){return{chat:{}}},mounted(){this.loadLedgerChatItemInfo()},methods:{loadLedgerChatItemInfo(){const t=document.getElementById("ledgerChatInfoModal");t&&t.addEventListener("show.bs.offcanvas",(t=>{const e=t.relatedTarget,a=e.getAttribute("data-bs-chat-id");this.chat=this.chats.find((t=>t.id==a))}))}}};const Dt=(0,I.c)(vt,[["render",yt]]);var xt=Dt;const Ct={class:"d-flex justify-content-center align-items-end w-100 position-relative bg-transparent"},wt=(0,s.QD)("div",{class:"d-flex flex-column justify-content-center align-items-center"},[(0,s.QD)("i",{class:"bi bi-x-lg fs-5 lh-1"})],-1),At=[wt],Qt=(0,s.QD)("div",{class:"d-flex flex-column justify-content-center align-items-center"},[(0,s.QD)("i",{class:"bi bi-mic-fill fs-5 lh-1"})],-1),Mt=[Qt],kt={key:3,class:"flex-fill"},Wt=(0,s.QD)("div",{class:"d-flex flex-column justify-content-center align-items-center"},[(0,s.QD)("i",{class:"bi bi-send-fill fs-5 lh-1"})],-1),zt=[Wt];function St(t,e,a,i,o,r){const d=(0,s.E1)("AudioClip");return(0,s.Wz)(),(0,s.An)("div",Ct,[o.showAudioMessage?((0,s.Wz)(),(0,s.An)("button",{key:0,class:"btn btn-dark rounded-circle mx-1 mb-2 wh-40",onClick:e[0]||(e[0]=(...t)=>r.toggleAudioMessage&&r.toggleAudioMessage(...t))},At)):((0,s.Wz)(),(0,s.An)("button",{key:1,class:"btn btn-dark rounded-circle mx-1 mb-2 wh-40",onClick:e[1]||(e[1]=(...t)=>r.toggleAudioMessage&&r.toggleAudioMessage(...t))},Mt)),o.showAudioMessage?((0,s.Wz)(),(0,s.Az)(d,{key:2,onRecordingCompleted:r.handleRecordingCompleted},null,8,["onRecordingCompleted"])):((0,s.Wz)(),(0,s.An)("div",kt,[(0,s.wt)((0,s.QD)("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.message=t),onInput:e[3]||(e[3]=(...t)=>r.adjustTextArea&&r.adjustTextArea(...t)),ref:"messageInput",class:"form-control rounded bg-white",rows:"1",style:{height:"auto","overflow-y":"auto","margin-bottom":"9px"}},null,544),[[n.Og,o.message]])])),o.showAudioMessage?(0,s.g1)("",!0):((0,s.Wz)(),(0,s.An)("button",{key:4,class:"btn btn-success rounded-circle mx-1 mb-2 wh-40",onClick:e[4]||(e[4]=(...t)=>r.sendMessage&&r.sendMessage(...t))},zt))])}const Rt={class:"d-flex flex-column justify-content-center align-items-center h-100"},Lt={key:0,class:"bi bi-mic fs-1"},Ft={key:1,class:"bi bg-danger bi-mic-fill fs-1"};function It(t,e,a,n,o,r){return(0,s.Wz)(),(0,s.An)("button",{class:(0,i.WN)(["btn rounded-circle mx-1 mb-2 wh-50",o.isRecording?"btn-danger":"btn-success"]),onMousedown:e[0]||(e[0]=(...t)=>r.toggleRecording&&r.toggleRecording(...t)),onMouseup:e[1]||(e[1]=(...t)=>r.toggleRecording&&r.toggleRecording(...t))},[(0,s.QD)("div",Rt,[o.isRecording?(0,s.g1)("",!0):((0,s.Wz)(),(0,s.An)("i",Lt)),o.isRecording?((0,s.Wz)(),(0,s.An)("i",Ft)):(0,s.g1)("",!0)])],34)}a(2168),a(5104),a(8312);var _t={name:"AudioClip",emits:["recordingCompleted"],data(){return{isRecording:!1,audioChunks:[],mediaRecorder:null,audioPlayer:null}},methods:{toggleRecording(){this.isRecording?this.stopRecording():this.startRecording()},startRecording(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{this.mediaRecorder=new MediaRecorder(t),this.audioChunks=[],this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.onstop=async()=>{const t=new Blob(this.audioChunks,{type:"audio/mp3"}),e=URL.createObjectURL(t),a=new FormData;a.append("audio",t,"recording.mp3"),a.append("type","audio"),a.append("content","chat audio"),a.append("ledger_sid","DG-LR-000"),this.$emit("recordingCompleted",{formData:a,audioUrl:e}),this.isRecording=!1},this.mediaRecorder.start(),this.isRecording=!0})).catch((t=>{console.error("Error accessing microphone:",t)})):console.error("MediaDevices API or getUserMedia not supported in this browser.")},stopRecording(){this.mediaRecorder&&this.mediaRecorder.stop()}}};const jt=(0,I.c)(_t,[["render",It]]);var $t=jt,Ut={name:"ChatActions",emits:["update-chats"],props:{ledgerSid:{type:String,required:!0}},components:{AudioClip:$t},data(){return{showAudioMessage:!1,showAttachMenu:!1,message:""}},watch:{chats(){this.$nextTick((()=>{this.adjustTextArea()}))}},methods:{async handleRecordingCompleted({formData:t,audioUrl:e}){try{console.log("Uploading file:",e);const a=await h.c.post("chats",t);this.$emit("update-chats",a.data.data)}catch(a){console.error("Error uploading file:",a)}},async sendMessage(){const t=await h.c.post("chats",{type:"text",content:this.message,ledger_sid:this.ledgerSid});this.$emit("update-chats",t.data.data),this.message=""},adjustTextArea(){const t=this.$refs.messageInput;t.style.height="auto",t.style.height=`${t.scrollHeight}px`,t.scrollHeight>250?(t.style.height="250px",t.style.overflowY="auto"):t.style.overflowY="hidden"},toggleAttachMenu(){this.showAttachMenu=!this.showAttachMenu},toggleAudioMessage(){this.showAudioMessage=!this.showAudioMessage}}};const Ot=(0,I.c)(Ut,[["render",St]]);var Et=Ot,Nt={name:"LedgerChatSection",props:{module:{type:String,required:!0}},data(){return{title:"Ledger Chat",backdrop:"https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg",chats:[],ledger:{},ledgerSid:"",page:1,hasMore:!0,isFetching:!1,paginate:{},filters:{search:"",start_date:"",end_date:"",opacity:!0}}},components:{ChatFilters:at,ChatCard:j,ChatDetails:xt,ChatActions:Et},created(){this.ledgerSid=this.$route.params.ledger,this.filters.end_date=(new Date).toISOString().split("T")[0];const t=new Date;t.setDate(t.getDate()-30),this.filters.start_date=t.toISOString().split("T")[0]},mounted(){this.loadMore(),window.addEventListener("scroll",this.handleScroll),this.$store.dispatch("brandy/setShowBottomNav",!1)},unmounted(){window.removeEventListener("scroll",this.handleScroll)},watch:{filters:{handler(t,e){t.search===e.search&&t.startDate===e.startDate&&t.endDate===e.endDate||(this.page=1,this.chats=[],this.loadMore())},deep:!0}},computed:{filteredChats(){let t=this.chats;return t}},methods:{handleScroll(){const{scrollTop:t,scrollHeight:e,clientHeight:a}=document.documentElement;a+t>=e-5&&this.loadMore()},handleFiltersChange(t){this.filters=t},loadMore(){this.isFetching||this.paginate&&this.page>this.paginate.lastPage?this.hasMore=!1:(this.isFetching=!0,console.log("Loading more chats..."),h.c.get(`chats/${this.ledgerSid}?page=${this.page}&search=${this.filters.search}&start_date=${this.filters.start_date}&end_date=${this.filters.end_date}`).then((t=>{if("ok"===t.data.status){this.chats=[...this.chats,...t.data.data.chats],this.paginate=t.data.data.pagination;const e=t.data.data.ledger;this.title=e.name,this.backdrop=e.image,this.page++,this.isFetching=!1}else"error"===t.data.status?(this.isFetching=!1,alert(t.data.message)):(this.isFetching=!1,alert("Something went wrong! Please try again"))})).catch((t=>{this.isFetching=!1,console.log(t),alert("Something went wrong! Please try again")})))},handleNewChat(t){this.chats.push(t)}}};const Pt=(0,I.c)(Nt,[["render",c]]);var Tt=Pt}}]);
//# sourceMappingURL=68.951878ab.js.map