"use strict";(self["webpackChunkwsgbrand_app_v1"]=self["webpackChunkwsgbrand_app_v1"]||[]).push([[696],{5076:function(t,e,s){s.r(e),s.d(e,{default:function(){return jt}});var a=s(4108),r=s(9096),d=s(7764);const l=t=>((0,a.ED)("data-v-ef408402"),t=t(),(0,a.ii)(),t),n={class:"font-title mb-3"},i={key:0,class:"border"},o={class:"table table-striped table-borderless mb-0",style:{"font-weight":"500"}},c={class:"table-dark"},m=l((()=>(0,a.QD)("th",{class:"ps-3 fw-bold text-start"},"Date",-1))),u=l((()=>(0,a.QD)("th",{class:"fw-bold text-start"},"Order",-1))),h={key:0,class:"fw-bold text-center"},g={key:1,class:"pe-3 fw-bold text-end"},p={key:2,class:"pe-3 fw-bold text-end"},b={key:0},y=["data-bs-ledgermodelsid"],D={class:"ps-3 text-start small"},f={key:1},w=l((()=>(0,a.QD)("td",{colspan:"4",class:"py-5 text-center"},[(0,a.QD)("span",null,"No data available based on current filter.")],-1))),Q=[w],k={key:1},x=["colspan"],A={class:"d-flex flex-column align-items-center justify-content-center"},v=l((()=>(0,a.QD)("span",null,"No ledger entries found.",-1))),L={key:2},W={class:"table-dark"},_=l((()=>(0,a.QD)("td",{class:"ps-3 text-start fw-bold",style:{"min-width":"90px"}}," Total ",-1))),F={class:"text-start",style:{"min-width":"90px"}},S={key:0,class:"text-center",style:{"min-width":"90px"}},q={key:1,class:"pe-3 text-end",style:{"min-width":"90px"}},C={key:2,class:"pe-3 text-end",style:{"min-width":"90px"}},j={key:0,"aria-label":"Page navigation"},O={class:"pagination"},z=["onClick"],P=l((()=>(0,a.QD)("i",{class:"bi bi-chevron-left"},null,-1))),I=[P],T=["onClick"],$=l((()=>(0,a.QD)("i",{class:"bi bi-chevron-right"},null,-1))),E=[$],V=["onClick"],N={class:"table table-striped table-borderless font-app"},M={key:0,class:"table-danger"},Y={class:"ps-2"},K=l((()=>(0,a.QD)("i",{class:"bi bi-chevron-right"},null,-1))),B=[K],R=l((()=>(0,a.QD)("span",{class:"ms-3"},"Not Yet Accepted",-1))),J={class:"pe-3 text-end"},U=l((()=>(0,a.QD)("span",{class:"smaller"},"pcs",-1))),H={class:"ps-2"},G=l((()=>(0,a.QD)("div",{class:"d-flex align-items-center"},[(0,a.QD)("i",{class:"pe-1 bi bi-plus fs-4 lh-1"}),(0,a.QD)("span",{style:{"margin-left":"-0.15rem"}},"Order")],-1))),X=[G],Z=l((()=>(0,a.QD)("span",{class:"ms-3"},"Order in Production",-1))),tt={class:"pe-3 text-end"},et=l((()=>(0,a.QD)("span",{class:"smaller"},"pcs",-1))),st={key:1},at={class:"ps-2"},rt=l((()=>(0,a.QD)("div",{class:"d-flex align-items-center"},[(0,a.QD)("i",{class:"pe-1 bi bi-plus fs-4 lh-1"}),(0,a.QD)("span",{style:{"margin-left":"-0.15rem"}},"Demand")],-1))),dt=[rt],lt=l((()=>(0,a.QD)("span",{class:"ms-3"},"Ready for Demand",-1))),nt={class:"pe-3 text-end"},it=l((()=>(0,a.QD)("span",{class:"smaller"},"pcs",-1))),ot={class:"ps-2"},ct=l((()=>(0,a.QD)("div",{class:"d-flex align-items-center"},[(0,a.QD)("i",{class:"pe-1 bi bi-plus fs-4 lh-1"}),(0,a.QD)("span",{style:{"margin-left":"-0.15rem"}},"Adjust")],-1))),mt=[ct],ut=l((()=>(0,a.QD)("span",{class:"ms-3"},"Ledger Balance Qty",-1))),ht={class:"pe-3 text-end"},gt=l((()=>(0,a.QD)("span",{class:"smaller"},"pcs",-1))),pt={key:1,class:"card mx-3 shadow"},bt={class:"card-body"},yt={class:"btn-group w-100"},Dt=l((()=>(0,a.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),ft={class:"btn-group w-100"},wt=l((()=>(0,a.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),Qt={class:"btn-group w-100"},kt=l((()=>(0,a.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),xt=l((()=>(0,a.QD)("div",{class:"modal fade",id:"ledgerImageModal",tabindex:"-1","aria-hidden":"true"},[(0,a.QD)("div",{class:"modal-dialog modal-fullscreen"},[(0,a.QD)("button",{type:"button",class:"btn h-100 w-100 p-0","data-bs-dismiss":"modal","aria-label":"Close"},[(0,a.QD)("img",{src:"https://placehold.co/400",class:"w-100",style:{"object-fit":"cover"}})])])],-1)));function At(t,e,s,l,w,P){const $=(0,a.E1)("LedgerFilters"),K=(0,a.E1)("LedgerForm"),G=(0,a.E1)("LedgerInfo");return(0,a.Wz)(),(0,a.An)("div",n,[(0,a.K2)($,{product:P.ledger.product,info:{label1:"Ready Done",label2:"Dispatch Done",value1:P.ledger.total_ready,value2:P.ledger.total_dispatch},onLedgerFiltersChanged:P.handleFiltersChange},null,8,["product","info","onLedgerFiltersChanged"]),w.addOrder||w.addDemand||w.addAdjustment?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.An)("div",i,[(0,a.QD)("table",o,[(0,a.QD)("thead",null,[(0,a.QD)("tr",c,[m,u,P.isVendor?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.An)("th",h,"Ready")),P.isVendor?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.An)("th",g,"Demand")),P.isVendor?((0,a.Wz)(),(0,a.An)("th",p,"Dispatch")):(0,a.g1)("",!0)])]),P.ledger.items&&P.ledger.items.data&&P.ledger.items.data.length?((0,a.Wz)(),(0,a.An)("tbody",b,[P.hasFilteredItems?((0,a.Wz)(!0),(0,a.An)(a.ae,{key:0},(0,a.mi)(P.filteredLedgerItems,((t,e)=>(0,a.wt)(((0,a.Wz)(),(0,a.An)("tr",{key:e,"data-bs-toggle":"offcanvas","data-bs-target":"#ledgerInfoModal","data-bs-ledgermodelsid":t.model_sid,"aria-controls":"ledgerInfoModal"},[(0,a.QD)("td",D,(0,r.WA)(P.formatDate(t.created_at)),1),(0,a.QD)("td",{colspan:"3",class:(0,r.WN)(["pe-3",[P.getTableDataClass(t),P.getActiveClass(t),{"text-danger":"adjustment"===t.model}]])},(0,r.WA)(t.quantity.toLocaleString()),3)],8,y)),[[d.Ub,P.shouldShow(t)]]))),128)):((0,a.Wz)(),(0,a.An)("tr",f,Q))])):((0,a.Wz)(),(0,a.An)("tbody",k,[(0,a.QD)("tr",null,[(0,a.QD)("td",{colspan:P.tableColspan,class:"py-5 text-center"},[(0,a.QD)("div",A,[v,(0,a.QD)("button",{class:"btn btn-sm btn-dark fw-bold",onClick:e[0]||(e[0]=(...t)=>P.showAddOrder&&P.showAddOrder(...t))}," Place First Order ")])],8,x)])])),P.ledger.items&&P.ledger.items.data&&P.ledger.items.data.length?((0,a.Wz)(),(0,a.An)("tfoot",L,[(0,a.QD)("tr",W,[_,(0,a.QD)("td",F,(0,r.WA)(P.calculateTotalOrder("order",P.ledger.items.data,"accepted")),1),P.isVendor?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.An)("td",S,(0,r.WA)(P.calculateTotal("ready").toLocaleString()),1)),P.isVendor?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.An)("td",q,(0,r.WA)(P.calculateTotal("demand").toLocaleString()),1)),P.isVendor?((0,a.Wz)(),(0,a.An)("td",C,(0,r.WA)(P.calculateTotal("dispatch").toLocaleString()),1)):(0,a.g1)("",!0)])])):(0,a.g1)("",!0)]),P.ledger.items&&P.ledger.items.data&&P.ledger.items.data.length?((0,a.Wz)(),(0,a.An)("nav",j,[(0,a.QD)("ul",O,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(w.visibleLinks,(t=>((0,a.Wz)(),(0,a.An)("li",{class:(0,r.WN)(["page-item flex-fill",{disabled:!t.url}]),key:t.label},[t.label.includes("Previous")?((0,a.Wz)(),(0,a.An)("a",{key:0,class:"page-link text-center text-dark",href:"#",onClick:(0,d.Y7)((e=>P.loadLedger(t.url)),["prevent"])},I,8,z)):t.label.includes("Next")?((0,a.Wz)(),(0,a.An)("a",{key:1,class:"page-link text-center text-dark",href:"#",onClick:(0,d.Y7)((e=>P.loadLedger(t.url)),["prevent"])},E,8,T)):((0,a.Wz)(),(0,a.An)("a",{key:2,href:"#",class:(0,r.WN)([{"text-primary fw-bold":this.activePage==t.label,"text-dark":this.activePage!=t.label},"page-link text-center"]),onClick:(0,d.Y7)((e=>P.loadLedger(t.url)),["prevent"])},(0,r.WA)(t.label),11,V))],2)))),128))])])):(0,a.g1)("",!0)])),(0,a.QD)("table",N,[(0,a.QD)("tbody",null,[P.ledger.unaccepted?((0,a.Wz)(),(0,a.An)("tr",M,[(0,a.QD)("td",Y,[(0,a.QD)("button",{class:"btn btn-sm btn-dark",onClick:e[1]||(e[1]=(...t)=>P.goToOrder&&P.goToOrder(...t))},B),R]),(0,a.QD)("td",J,[(0,a.mY)((0,r.WA)(P.ledger.unaccepted?P.ledger.unaccepted.toLocaleString():0)+" ",1),U])])):(0,a.g1)("",!0),(0,a.QD)("tr",null,[(0,a.QD)("td",H,[(0,a.QD)("button",{class:"text-start btn btn-sm btn-dark px-1 w-90p",onClick:e[2]||(e[2]=(...t)=>P.showAddOrder&&P.showAddOrder(...t))},X),Z]),(0,a.QD)("td",tt,[(0,a.mY)((0,r.WA)(P.ledger.readyable_qty?P.ledger.readyable_qty.toLocaleString():0)+" ",1),et])]),P.isFactoryLedger?((0,a.Wz)(),(0,a.An)("tr",st,[(0,a.QD)("td",at,[(0,a.QD)("button",{class:"text-start btn btn-sm btn-dark px-1 w-90p",onClick:e[3]||(e[3]=(...t)=>P.showAddDemand&&P.showAddDemand(...t))},dt),lt]),(0,a.QD)("td",nt,[(0,a.mY)((0,r.WA)(P.ledger.demandable_qty?P.ledger.demandable_qty.toLocaleString():0)+" ",1),it])])):(0,a.g1)("",!0),(0,a.QD)("tr",null,[(0,a.QD)("td",ot,[P.isVendor?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.An)("button",{key:0,class:"text-start btn btn-sm btn-dark px-1 w-90p",onClick:e[4]||(e[4]=(...t)=>P.showAddAdjustment&&P.showAddAdjustment(...t))},mt)),ut]),(0,a.QD)("td",ht,[(0,a.mY)((0,r.WA)(P.ledger.balance_qty?P.ledger.balance_qty.toLocaleString():0)+" ",1),gt])])])]),w.addOrder||w.addDemand||w.addAdjustment?((0,a.Wz)(),(0,a.An)("div",pt,[(0,a.QD)("div",bt,[w.addOrder?((0,a.Wz)(),(0,a.An)("form",{key:0,onSubmit:e[6]||(e[6]=(0,d.Y7)((t=>P.postOrder()),["prevent"])),method:"post"},[(0,a.K2)(K,{product:P.ledger.product,type:"order",onFormData:P.handleFormData,isFactoryLedger:P.isFactoryLedger},null,8,["product","onFormData","isFactoryLedger"]),(0,a.QD)("div",yt,[(0,a.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[5]||(e[5]=(...t)=>P.showLedgerSummary&&P.showLedgerSummary(...t))}," Cancel "),Dt])],32)):(0,a.g1)("",!0),w.addDemand&&P.isFactoryLedger?((0,a.Wz)(),(0,a.An)("form",{key:1,onSubmit:e[8]||(e[8]=(0,d.Y7)((t=>P.postDemand()),["prevent"])),method:"post"},[(0,a.K2)(K,{product:P.ledger.product,type:"demand",onFormData:P.handleFormData,isFactoryLedger:P.isFactoryLedger},null,8,["product","onFormData","isFactoryLedger"]),(0,a.QD)("div",ft,[(0,a.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[7]||(e[7]=(...t)=>P.showLedgerSummary&&P.showLedgerSummary(...t))}," Cancel "),wt])],32)):(0,a.g1)("",!0),w.addAdjustment?((0,a.Wz)(),(0,a.An)("form",{key:2,onSubmit:e[10]||(e[10]=(0,d.Y7)((t=>P.postAdjustment()),["prevent"])),method:"post"},[(0,a.K2)(K,{product:P.ledger.product,ledger:P.ledger,type:"adjustment",onFormData:P.handleFormData,isFactoryLedger:P.isFactoryLedger},null,8,["product","ledger","onFormData","isFactoryLedger"]),(0,a.QD)("div",Qt,[(0,a.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[9]||(e[9]=(...t)=>P.showLedgerSummary&&P.showLedgerSummary(...t))}," Cancel "),kt])],32)):(0,a.g1)("",!0)])])):(0,a.g1)("",!0),xt,(0,a.K2)(G,{items:P.ledger.items},null,8,["items"])])}s(3248);var vt=s(8656),Lt=s.n(vt),Wt=s(5456),_t=s(4424),Ft=s(6878),St={name:"FactoryLedger",props:{module:{type:String,default:"brand"}},components:{LedgerFilters:Wt.c,LedgerInfo:_t.c,LedgerForm:Ft.c},data(){return{filters:[],formData:[],addOrder:!1,addDemand:!1,addAdjustment:!1,total:0,activePage:1,visibleLinks:[]}},watch:{"ledger.items":{immediate:!0,handler(){this.calculateVisibleLinks()}},activePage(){this.calculateVisibleLinks()}},created(){this.loadLedger("",!0),this.$store.dispatch("brandy/setShowBottomNav",!0)},mounted(){const t=document.getElementById("ledgerImageModal");t&&t.addEventListener("show.bs.modal",(e=>{const s=e.relatedTarget,a=s.getAttribute("data-bs-url"),r=t.querySelector(".modal-dialog img");r.src=a}))},computed:{ledger(){return this.$store.getters["brandy/ledger"]},isFactoryLedger(){return void 0!==this.ledger.party_id&&"Product Factory"===this.ledger.party_id.type},filteredLedgerItems(){const t=new Date(this.filters.startDate),e=new Date(this.filters.endDate);return this.ledger.items.data.filter((s=>{const a=new Date(s.created_on);return a>=t&&a<=e}))},hasFilteredItems(){return this.filteredLedgerItems&&this.filteredLedgerItems.length>0},isVendor(){return void 0!==this.ledger.party_id&&"Product Vendor"===this.ledger.party_id.type},tableColspan(){return this.isVendor?3:4},hasErrors(){return Object.keys(this.$store.getters.errors).length>0}},methods:{calculateVisibleLinks(){if(!this.ledger.items||!this.ledger.items.links)return;const t=this.ledger.items.links.length-2;let e=Math.max(1,this.activePage-4),s=Math.min(t,this.activePage+3);t>8?s-e<7&&(1===e?s=8:s===t&&(e=t-7)):(e=1,s=t),this.visibleLinks=this.ledger.items.links.filter(((t,a)=>t.label.includes("Previous")||t.label.includes("Next")||a>=e&&a<=s))},loadLedger(t,e){this.activePage=1,e||(this.activePage=t.split("=")[1]),this.$store.dispatch("brandy/fetchProductLedger",{ledger:this.$route.params.ledger,page:this.activePage})},showAddOrder(){this.addAdjustment=!1,this.addDemand=!1,this.addOrder=!0},showAddDemand(){this.addAdjustment=!1,this.addOrder=!1,this.addDemand=!0},showAddAdjustment(){this.addOrder=!1,this.addDemand=!1,this.addAdjustment=!0},showLedgerSummary(){this.addOrder=!1,this.addDemand=!1,this.addAdjustment=!1},getTableDataClass(t){switch(t.model){case"order":return this.filters.order?"text-start":"text-danger";case"ready":return this.filters.ready?"text-center":"text-danger";case"demand":return this.filters.demand?"text-end":"text-danger";case"adjustment":return this.againTry(t);default:return"text-end"}},againTry(t){switch(t.type){case"order":return this.filters.adjustment?"text-start":"text-danger";case"ready":return this.filters.adjustment?"text-center":"text-danger";case"demand":return this.filters.adjustment?"text-end":"text-danger"}},handleInput(t){t&&"object"===typeof t&&(void 0===t.quantity&&this.$set(t,"quantity",0),t.quantity=Math.max(0,t.quantity))},getActiveClass(t){return{"text-primary":"issued"===t.status,"text-warning":"cancelled"===t.status,"text-dark":"accepted"===t.status}},shouldShow(t){if("Product Vendor"!==this.ledger.party_id.type&&"dispatch"===t.model)return!1;if("Product Vendor"===this.ledger.party_id.type&&"ready"===t.model)return!1;if("Product Vendor"===this.ledger.party_id.type&&"demand"===t.model)return!1;let e=this.filters[t.model];return"adjustment"===t.model?e&&this.filters[t.type]:e},calculateTotal(t){return this.ledger?.items?.data&&Array.isArray(this.ledger.items.data)&&this.filters[t]?this.ledger.items.data.reduce(((e,s)=>s.model===t?e+s.quantity:"adjustment"===s.model&&s.type===t&&this.filters["adjustment"]?e-s.quantity:e),0):0},calculateTotalOrder(t,e,s){if(e&&Array.isArray(e)){const a=e.filter((e=>e.model===t&&this.filters[t]&&e.status===s));return a.reduce(((t,e)=>t+e.quantity),0)}return 0},formatDate(t){const e={weekday:"short",month:"short",day:"numeric"},s=new Date(t).toLocaleDateString("en-US",e);return s},validateForm(){let t=!0;this.errors={},this.formData.content&&this.formData.content.length>255&&(this.errors.content="Content must be 255 characters or less.",t=!1),this.formData.ledger_sid||(this.errors.ledger_sid="Ledger SID is required.",t=!1),this.formData.quantities||(this.errors.quantities="Quantities are required.",t=!1);const e=new Date;e.setHours(0,0,0,0);const s=new Date(e);s.setMonth(s.getMonth()+1);const a=new Date(this.formData.date);return(a<e||a>s)&&(this.errors.date="Date must be today or within the next month.",t=!1),t},postOrder(){this.ledger.product.active?this.postCommon("brandy/postNewOrder"):Lt().fire({icon:"error",title:"In Draft Mode",text:"This product is in draft mode. Please activate the product first."})},postDemand(){this.postCommon("brandy/postNewDemand")},postAdjustment(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>{const s=this.ledger.product.ranges.filter((e=>this.formData.ranges[`${t.sid}_${e.sid}`]));let a=0;if(s.length>0){const t=parseInt(this.formData.quantity[e])||0;a=Math.max(Math.ceil(t/s.length),0)}return s.map((e=>{const s=`${t.sid}_${e.sid}`;return{[s]:a}}))})).flat();let e=0,s=[];if(t.forEach((t=>{const a=Object.keys(t)[0],r=t[a];r&&r>0&&(e+=r,s.push(t))})),"order"===this.formData.adjtype&&e>this.ledger.readyable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.readyable_qty+" pcs.");if("demand"===this.formData.adjtype&&e>this.ledger.dispatchable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.dispatchable_qty+" pcs.");const a={ledger_sid:this.ledger.sid,content:this.formData.content,type:this.formData.adjtype,expected_at:this.formData.date,tolerance:this.formData.tolerance,product:this.ledger.product.slug,quantities:JSON.stringify(s)};console.log(a),this.$store.dispatch("brandy/postNewAdjustment",a),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},postCommon(t){if(this.ledger.product.options&&this.total>0){const e=this.ledger.product.options.map(((t,e)=>{const s=this.ledger.product.ranges.filter((e=>this.formData.ranges[`${t.sid}_${e.sid}`]));let a=0;if(s.length>0){const t=parseInt(this.formData.quantity[e])||0;a=Math.max(Math.ceil(t/s.length),0)}return s.map((e=>{const s=`${t.sid}_${e.sid}`;return{[s]:a}}))})).flat();let s=0,a=[];if(e.forEach((t=>{const e=Object.keys(t)[0],r=t[e];r&&r>0&&(s+=r,a.push(t))})),"brandy/postNewDemand"===t&&s>this.ledger.demandable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.demandable_qty+" pcs.");const r={ledger_sid:this.ledger.sid,content:this.formData.content,expected_at:this.formData.date,tolerance:this.formData.tolerance,product:this.ledger.product.slug,quantities:JSON.stringify(a)};this.$store.dispatch(t,r),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},showQtyError(t,e){Lt().fire({icon:"error",title:t,text:e})},handleFiltersChange(t){this.filters=t},handleFormData(t){this.formData=t.data,this.total=t.total},goToOrder(){this.$router.push({name:"BrandPos"})}}},qt=s(4100);const Ct=(0,qt.c)(St,[["render",At],["__scopeId","data-v-ef408402"]]);var jt=Ct}}]);
//# sourceMappingURL=696.998c6f76.js.map