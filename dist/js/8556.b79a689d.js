"use strict";(self["webpackChunkwsgbrand_app_v1"]=self["webpackChunkwsgbrand_app_v1"]||[]).push([[8556],{8556:function(t,e,a){a.r(e),a.d(e,{default:function(){return nt}});var s=a(4108),l=a(9096),d=a(7764);const r=t=>((0,s.ED)("data-v-0e9369aa"),t=t(),(0,s.ii)(),t),i={class:"font-title"},n={key:0,class:"border"},o={class:"table table-striped table-borderless mb-0",style:{"font-weight":"500"}},c=r((()=>(0,s.QD)("thead",null,[(0,s.QD)("tr",{class:"table-dark"},[(0,s.QD)("th",{class:"ps-3 fw-bold text-start"},"Date"),(0,s.QD)("th",{class:"fw-bold text-start"},"Order"),(0,s.QD)("th",{class:"pe-3 fw-bold text-end"},"Dispatch")])],-1))),u={key:0},h=["data-bs-ledgermodelsid"],g={class:"ps-3 text-start"},m={key:1},p=r((()=>(0,s.QD)("td",{colspan:"4",class:"py-5 text-center"},[(0,s.QD)("span",null,"No data available based on current filter.")],-1))),b=[p],D={key:1},y={class:"table-dark"},f=r((()=>(0,s.QD)("td",{class:"ps-3 text-start fw-bold",style:{"min-width":"90px"}}," Total ",-1))),k={class:"text-start",style:{"min-width":"90px"}},Q={class:"pe-3 text-end",style:{"min-width":"90px"}},v={key:0,"aria-label":"Page navigation"},w={class:"pagination"},A=["onClick"],x=r((()=>(0,s.QD)("i",{class:"bi bi-chevron-left"},null,-1))),L=[x],W=["onClick"],_=r((()=>(0,s.QD)("i",{class:"bi bi-chevron-right"},null,-1))),C=[_],S=["onClick"],j={class:"table table-striped table-borderless"},q={class:"ps-3"},P=r((()=>(0,s.QD)("i",{class:"bi bi-chevron-left"},null,-1))),F=r((()=>(0,s.QD)("span",{class:"ms-3"},"Order Pending",-1))),z={class:"pe-3 text-end"},I={class:"ps-3"},E=r((()=>(0,s.QD)("i",{class:"bi bi-plus-lg"},null,-1))),T=[E],$=r((()=>(0,s.QD)("span",{class:"ms-3"},"Dispatch Pending",-1))),N={class:"pe-3 text-end"},M={class:"ps-3"},O=r((()=>(0,s.QD)("i",{class:"bi bi-plus-lg"},null,-1))),V=[O],K=r((()=>(0,s.QD)("span",{class:"ms-3"},"Ledger Balance",-1))),Y={class:"pe-3 text-end"},B={key:1,class:"card mx-3 shadow"},U={class:"card-body"},J={class:"btn-group w-100"},G=r((()=>(0,s.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),H={class:"btn-group w-100"},R=r((()=>(0,s.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),X=r((()=>(0,s.QD)("div",{class:"modal fade",id:"ledgerImageModal",tabindex:"-1","aria-hidden":"true"},[(0,s.QD)("div",{class:"modal-dialog modal-fullscreen"},[(0,s.QD)("button",{type:"button",class:"btn h-100 w-100 p-0","data-bs-dismiss":"modal","aria-label":"Close"},[(0,s.QD)("img",{src:"https://placehold.co/400",class:"w-100",style:{"object-fit":"cover"}})])])],-1)));function Z(t,e,a,r,p,x){const _=(0,s.E1)("LedgerFilters"),E=(0,s.E1)("router-link"),O=(0,s.E1)("LedgerForm"),Z=(0,s.E1)("LedgerInfo");return(0,s.Wz)(),(0,s.An)("div",i,[(0,s.K2)(_,{product:x.ledger.product,info:{label1:"Total Order",label2:"Dispatch Done",value1:x.ledger.total_order,value2:x.ledger.total_dispatch},onLedgerFiltersChanged:x.handleFiltersChange},null,8,["product","info","onLedgerFiltersChanged"]),p.addDispatch||p.addAdjustment?(0,s.g1)("",!0):((0,s.Wz)(),(0,s.An)("div",n,[(0,s.QD)("table",o,[c,x.ledger.items&&x.ledger.items.data&&x.ledger.items.data.length?((0,s.Wz)(),(0,s.An)("tbody",u,[x.hasFilteredItems?((0,s.Wz)(!0),(0,s.An)(s.ae,{key:0},(0,s.mi)(x.filteredLedgerItems,((t,e)=>(0,s.wt)(((0,s.Wz)(),(0,s.An)("tr",{key:e,"data-bs-toggle":"offcanvas","data-bs-target":"#ledgerInfoModal","data-bs-ledgermodelsid":t.model_sid,"aria-controls":"ledgerInfoModal"},[(0,s.QD)("td",g,(0,l.WA)(x.formatDate(t.created_at)),1),(0,s.QD)("td",{colspan:"3",class:(0,l.WN)(["pe-3",[x.getTableDataClass(t),x.getActiveClass(t),{"text-danger":"adjustment"===t.model}]])},(0,l.WA)(t.quantity.toLocaleString()),3)],8,h)),[[d.Ub,x.shouldShow(t)]]))),128)):((0,s.Wz)(),(0,s.An)("tr",m,b))])):(0,s.g1)("",!0),x.ledger.items&&x.ledger.items.data&&x.ledger.items.data.length?((0,s.Wz)(),(0,s.An)("tfoot",D,[(0,s.QD)("tr",y,[f,(0,s.QD)("td",k,(0,l.WA)(x.calculateTotal("order").toLocaleString()),1),(0,s.QD)("td",Q,(0,l.WA)(x.calculateTotal("dispatch").toLocaleString()),1)])])):(0,s.g1)("",!0)]),x.ledger.items&&x.ledger.items.data&&x.ledger.items.data.length?((0,s.Wz)(),(0,s.An)("nav",v,[(0,s.QD)("ul",w,[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(p.visibleLinks,(t=>((0,s.Wz)(),(0,s.An)("li",{class:(0,l.WN)(["page-item flex-fill",{disabled:!t.url}]),key:t.label},[t.label.includes("Previous")?((0,s.Wz)(),(0,s.An)("a",{key:0,class:"page-link text-center text-dark",href:"#",onClick:(0,d.Y7)((e=>x.loadLedger(t.url)),["prevent"])},L,8,A)):t.label.includes("Next")?((0,s.Wz)(),(0,s.An)("a",{key:1,class:"page-link text-center text-dark",href:"#",onClick:(0,d.Y7)((e=>x.loadLedger(t.url)),["prevent"])},C,8,W)):((0,s.Wz)(),(0,s.An)("a",{key:2,href:"#",class:(0,l.WN)([{"text-primary fw-bold":this.activePage==t.label,"text-dark":this.activePage!=t.label},"page-link text-center"]),onClick:(0,d.Y7)((e=>x.loadLedger(t.url)),["prevent"])},(0,l.WA)(t.label),11,S))],2)))),128))])])):(0,s.g1)("",!0)])),(0,s.QD)("table",j,[(0,s.QD)("tbody",null,[(0,s.QD)("tr",null,[(0,s.QD)("td",q,[(0,s.K2)(E,{to:{name:"VendorOrders"},class:"btn btn-sm btn-dark rounded-0"},{default:(0,s.Ql)((()=>[P])),_:1}),F]),(0,s.QD)("td",z,(0,l.WA)(x.ledger.readyable_qty?x.ledger.readyable_qty.toLocaleString():0)+" pcs ",1)]),(0,s.QD)("tr",null,[(0,s.QD)("td",I,[(0,s.QD)("button",{class:"btn btn-sm btn-dark rounded-0",onClick:e[0]||(e[0]=(...t)=>x.showAddDispatch&&x.showAddDispatch(...t))},T),$]),(0,s.QD)("td",N,(0,l.WA)(x.ledger.dispatchable_qty?x.ledger.dispatchable_qty.toLocaleString():0)+" pcs ",1)]),(0,s.QD)("tr",null,[(0,s.QD)("td",M,[(0,s.QD)("button",{class:"btn btn-sm btn-dark rounded-0",onClick:e[1]||(e[1]=(...t)=>x.showAddAdjustment&&x.showAddAdjustment(...t))},V),K]),(0,s.QD)("td",Y,(0,l.WA)(x.ledger.balance_qty?x.ledger.balance_qty.toLocaleString():0)+" pcs ",1)])])]),p.addDispatch||p.addAdjustment?((0,s.Wz)(),(0,s.An)("div",B,[(0,s.QD)("div",U,[p.addDispatch?((0,s.Wz)(),(0,s.An)("form",{key:0,onSubmit:e[3]||(e[3]=(0,d.Y7)((t=>x.postDispatch()),["prevent"])),method:"post"},[(0,s.K2)(O,{product:x.ledger.product,type:"dispatch",onFormData:x.handleFormData},null,8,["product","onFormData"]),(0,s.QD)("div",J,[(0,s.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[2]||(e[2]=(...t)=>x.showLedgerSummary&&x.showLedgerSummary(...t))}," Cancel "),G])],32)):(0,s.g1)("",!0),p.addAdjustment?((0,s.Wz)(),(0,s.An)("form",{key:1,onSubmit:e[5]||(e[5]=(0,d.Y7)((e=>t.postAdjustment()),["prevent"])),method:"post"},[(0,s.K2)(O,{product:x.ledger.product,type:"adjustment",onFormData:x.handleFormData},null,8,["product","onFormData"]),(0,s.QD)("div",H,[(0,s.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[4]||(e[4]=(...t)=>x.showLedgerSummary&&x.showLedgerSummary(...t))}," Cancel "),R])],32)):(0,s.g1)("",!0)])])):(0,s.g1)("",!0),X,(0,s.K2)(Z,{items:x.ledger.items},null,8,["items"])])}a(3248);var tt=a(8656),et=a.n(tt),at=a(8620),st=a(4424),lt=a(1708),dt={name:"LedgerDetailPage",components:{LedgerFilters:at.c,LedgerInfo:st.c,LedgerForm:lt.c},data(){return{filters:[],formData:[],addDispatch:!1,addAdjustment:!1,total:0,activePage:1,visibleLinks:[]}},watch:{"ledger.items":{immediate:!0,handler(){this.calculateVisibleLinks()}},activePage(){this.calculateVisibleLinks()}},created(){console.log("Vendor LedgerDetailPage created"),this.loadLedger("",!0),console.log("Vendor LedgerDetailPage created")},mounted(){const t=document.getElementById("ledgerImageModal");t&&t.addEventListener("show.bs.modal",(e=>{const a=e.relatedTarget,s=a.getAttribute("data-bs-url"),l=t.querySelector(".modal-dialog img");l.src=s}))},computed:{ledger(){return this.$store.getters["vendor/ledger"]},filteredLedgerItems(){const t=new Date(this.filters.startDate),e=new Date(this.filters.endDate);return this.ledger.items.data.filter((a=>{const s=new Date(a.created_at);return s>=t&&s<=e}))},hasFilteredItems(){return this.filteredLedgerItems&&this.filteredLedgerItems.length>0}},methods:{calculateVisibleLinks(){const t=this.ledger.items.links.length-2;let e=Math.max(1,this.activePage-4),a=Math.min(t,this.activePage+3);t>8?a-e<7&&(1===e?a=8:a===t&&(e=t-7)):(e=1,a=t),this.visibleLinks=this.ledger.items.links.filter(((t,s)=>t.label.includes("Previous")||t.label.includes("Next")||s>=e&&s<=a))},loadLedger(t,e){this.activePage=1,e||(this.activePage=t.split("=")[1]),this.$store.dispatch("vendor/fetchProductLedger",{ledger:this.$route.params.ledger,page:this.activePage})},showAddDispatch(){this.addAdjustment=!1,this.addDispatch=!0},showAddAdjustment(){this.addDispatch=!1,this.addAdjustment=!0},showLedgerSummary(){this.addDispatch=!1,this.addAdjustment=!1},getTableDataClass(t){switch(t.model){case"order":return this.filters.order?"text-start":"text-danger";case"dispatch":return this.filters.dispatch?"text-end":"text-danger";case"adjustment":return this.againTry(t);default:return"text-end"}},againTry(t){switch(t.type){case"order":return this.filters.adjustment?"text-start":"text-danger";case"dispatch":return this.filters.adjustment?"text-end":"text-danger"}},handleInput(t){t&&"object"===typeof t&&(void 0===t.quantity&&this.$set(t,"quantity",0),t.quantity=Math.max(0,t.quantity))},getActiveClass(t){return{"text-primary":"issued"===t.status,"text-warning":"cancelled"===t.status,"text-dark":"accepted"===t.status}},shouldShow(t){let e=this.filters[t.model];return"ready"!==t.model&&"demand"!==t.model&&("adjustment"===t.model?e&&this.filters[t.type]:e)},calculateTotal(t){return this.ledger?.items?.data&&Array.isArray(this.ledger.items.data)&&this.filters[t]?this.ledger.items.data.reduce(((e,a)=>a.model===t?e+a.quantity:"adjustment"===a.model&&a.type===t&&this.filters["adjustment"]?e-a.quantity:e),0):0},formatDate(t){const e={weekday:"short",month:"short",day:"numeric"},a=new Date(t).toLocaleDateString("en-US",e);return a},postDispatch(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>this.ledger.product.ranges.filter((e=>{const a=`${t.sid}_${e.sid}`;return this.formData.ranges[a]})).map((a=>{const s=`${t.sid}_${a.sid}`,l=this.formData.quantity[e];return{[s]:l}})))).flat();let e=0,a=[];if(t.forEach((t=>{const s=Object.keys(t)[0],l=t[s];l&&l>0&&(e+=l,a.push(t))})),e>this.ledger.dispatchable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.dispatchable_qty+" pcs.");const s={ledger_sid:this.ledger.sid,content:this.formData.content,expected_at:this.formData.date,quantities:JSON.stringify(a)};this.$store.dispatch("factory/postNewDispatch",s),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},showQtyError(t,e){et().fire({icon:"error",title:t,text:e})},handleFiltersChange(t){this.filters=t},handleFormData(t){this.formData=t.data,this.total=t.total}}},rt=a(4100);const it=(0,rt.c)(dt,[["render",Z],["__scopeId","data-v-0e9369aa"]]);var nt=it}}]);
//# sourceMappingURL=8556.b79a689d.js.map