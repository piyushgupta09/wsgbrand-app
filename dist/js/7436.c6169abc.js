"use strict";(self["webpackChunkwsgbrand_app_v1"]=self["webpackChunkwsgbrand_app_v1"]||[]).push([[7436],{7436:function(t,e,a){a.r(e),a.d(e,{default:function(){return ut}});var s=a(4108),d=a(9096),r=a(7764);const l=t=>((0,s.ED)("data-v-2c464fec"),t=t(),(0,s.ii)(),t),i={class:"font-title"},n={key:0,class:"border"},o={class:"table table-striped table-borderless mb-0",style:{"font-weight":"500"}},c=l((()=>(0,s.QD)("thead",null,[(0,s.QD)("tr",{class:"table-dark"},[(0,s.QD)("th",{class:"ps-3 fw-bold text-start"},"Date"),(0,s.QD)("th",{class:"fw-bold text-start"},"Order"),(0,s.QD)("th",{class:"fw-bold text-center"},"Ready"),(0,s.QD)("th",{class:"pe-3 fw-bold text-end"},"Demand")])],-1))),h={key:0},u=["data-bs-ledgermodelsid"],g={class:"ps-3 text-start"},m={key:1},p=l((()=>(0,s.QD)("td",{colspan:"4",class:"py-5 text-center"},[(0,s.QD)("span",null,"No data available based on current filter.")],-1))),b=[p],y={key:1},f={class:"table-dark"},D=l((()=>(0,s.QD)("td",{class:"ps-3 text-start fw-bold",style:{"min-width":"90px"}}," Total ",-1))),w={class:"text-start",style:{"min-width":"90px"}},Q={class:"text-center",style:{"min-width":"90px"}},k={class:"pe-3 text-end",style:{"min-width":"90px"}},x={key:0,"aria-label":"Page navigation"},A={class:"pagination"},v=["onClick"],L=l((()=>(0,s.QD)("i",{class:"bi bi-chevron-left"},null,-1))),_=[L],S=["onClick"],q=l((()=>(0,s.QD)("i",{class:"bi bi-chevron-right"},null,-1))),j=[q],W=["onClick"],C={class:"table table-striped table-borderless"},F={class:"ps-3"},$=l((()=>(0,s.QD)("i",{class:"bi bi-plus-lg"},null,-1))),z=[$],I=l((()=>(0,s.QD)("span",{class:"ms-3"},"In Production",-1))),R={class:"pe-3 text-end"},E={class:"ps-3"},P=l((()=>(0,s.QD)("i",{class:"bi bi-plus-lg"},null,-1))),M=[P],N=l((()=>(0,s.QD)("span",{class:"ms-3"},"Demand Raised",-1))),T={class:"pe-3 text-end"},O={class:"ps-3"},Y=l((()=>(0,s.QD)("i",{class:"bi bi-plus-lg"},null,-1))),K=[Y],B=l((()=>(0,s.QD)("span",{class:"ms-3"},"Ledger Balance",-1))),J={class:"pe-3 text-end"},V={key:1,class:"card mx-3 shadow"},U={class:"card-body"},G={class:"btn-group w-100"},H=l((()=>(0,s.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),X={class:"btn-group w-100"},Z=l((()=>(0,s.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),tt={class:"btn-group w-100"},et=l((()=>(0,s.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),at=l((()=>(0,s.QD)("div",{class:"modal fade",id:"ledgerImageModal",tabindex:"-1","aria-hidden":"true"},[(0,s.QD)("div",{class:"modal-dialog modal-fullscreen"},[(0,s.QD)("button",{type:"button",class:"btn h-100 w-100 p-0","data-bs-dismiss":"modal","aria-label":"Close"},[(0,s.QD)("img",{src:"https://placehold.co/400",class:"w-100",style:{"object-fit":"cover"}})])])],-1)));function st(t,e,a,l,p,L){const q=(0,s.E1)("LedgerFilters"),$=(0,s.E1)("LedgerForm"),P=(0,s.E1)("LedgerInfo");return(0,s.Wz)(),(0,s.An)("div",i,[(0,s.K2)(q,{product:L.ledger.product,info:{label1:"Ready Done",label2:"Dispatch Done",value1:L.ledger.total_ready,value2:L.ledger.total_dispatch},onLedgerFiltersChanged:L.handleFiltersChange},null,8,["product","info","onLedgerFiltersChanged"]),p.addReady||p.addDispatch||p.addAdjustment?(0,s.g1)("",!0):((0,s.Wz)(),(0,s.An)("div",n,[(0,s.QD)("table",o,[c,L.ledger.items&&L.ledger.items.data&&L.ledger.items.data.length?((0,s.Wz)(),(0,s.An)("tbody",h,[L.hasFilteredItems?((0,s.Wz)(!0),(0,s.An)(s.ae,{key:0},(0,s.mi)(L.filteredLedgerItems,((t,e)=>(0,s.wt)(((0,s.Wz)(),(0,s.An)("tr",{key:e,"data-bs-toggle":"offcanvas","data-bs-target":"#ledgerInfoModal","data-bs-ledgermodelsid":t.model_sid,"aria-controls":"ledgerInfoModal"},[(0,s.QD)("td",g,(0,d.WA)(L.formatDate(t.created_at)),1),(0,s.QD)("td",{colspan:"3",class:(0,d.WN)(["pe-3",[L.getTableDataClass(t),L.getActiveClass(t),{"text-danger":"adjustment"===t.model}]])},(0,d.WA)(t.quantity.toLocaleString()),3)],8,u)),[[r.Ub,L.shouldShow(t)]]))),128)):((0,s.Wz)(),(0,s.An)("tr",m,b))])):(0,s.g1)("",!0),L.ledger.items&&L.ledger.items.data&&L.ledger.items.data.length?((0,s.Wz)(),(0,s.An)("tfoot",y,[(0,s.QD)("tr",f,[D,(0,s.QD)("td",w,(0,d.WA)(L.calculateTotal("order").toLocaleString()),1),(0,s.QD)("td",Q,(0,d.WA)(L.calculateTotal("ready").toLocaleString()),1),(0,s.QD)("td",k,(0,d.WA)(L.calculateTotal("demand").toLocaleString()),1)])])):(0,s.g1)("",!0)]),L.ledger.items&&L.ledger.items.data&&L.ledger.items.data.length?((0,s.Wz)(),(0,s.An)("nav",x,[(0,s.QD)("ul",A,[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(p.visibleLinks,(t=>((0,s.Wz)(),(0,s.An)("li",{class:(0,d.WN)(["page-item flex-fill",{disabled:!t.url}]),key:t.label},[t.label.includes("Previous")?((0,s.Wz)(),(0,s.An)("a",{key:0,class:"page-link text-center text-dark",href:"#",onClick:(0,r.Y7)((e=>L.loadLedger(t.url)),["prevent"])},_,8,v)):t.label.includes("Next")?((0,s.Wz)(),(0,s.An)("a",{key:1,class:"page-link text-center text-dark",href:"#",onClick:(0,r.Y7)((e=>L.loadLedger(t.url)),["prevent"])},j,8,S)):((0,s.Wz)(),(0,s.An)("a",{key:2,href:"#",class:(0,d.WN)([{"text-primary fw-bold":this.activePage==t.label,"text-dark":this.activePage!=t.label},"page-link text-center"]),onClick:(0,r.Y7)((e=>L.loadLedger(t.url)),["prevent"])},(0,d.WA)(t.label),11,W))],2)))),128))])])):(0,s.g1)("",!0)])),(0,s.QD)("table",C,[(0,s.QD)("tbody",null,[(0,s.QD)("tr",null,[(0,s.QD)("td",F,[(0,s.QD)("button",{class:"btn btn-sm btn-dark rounded-0",onClick:e[0]||(e[0]=(...t)=>L.showAddReady&&L.showAddReady(...t))},z),I]),(0,s.QD)("td",R,(0,d.WA)(L.ledger.readyable_qty?L.ledger.readyable_qty.toLocaleString():0)+" pcs ",1)]),(0,s.QD)("tr",null,[(0,s.QD)("td",E,[(0,s.QD)("button",{class:"btn btn-sm btn-dark rounded-0",onClick:e[1]||(e[1]=(...t)=>L.showAddDispatch&&L.showAddDispatch(...t))},M),N]),(0,s.QD)("td",T,(0,d.WA)(L.ledger.dispatchable_qty?L.ledger.dispatchable_qty.toLocaleString():0)+" pcs ",1)]),(0,s.QD)("tr",null,[(0,s.QD)("td",O,[(0,s.QD)("button",{class:"btn btn-sm btn-dark rounded-0",onClick:e[2]||(e[2]=(...t)=>L.showAddAdjustment&&L.showAddAdjustment(...t))},K),B]),(0,s.QD)("td",J,(0,d.WA)(L.ledger.balance_qty?L.ledger.balance_qty.toLocaleString():0)+" pcs ",1)])])]),p.addReady||p.addDispatch||p.addAdjustment?((0,s.Wz)(),(0,s.An)("div",V,[(0,s.QD)("div",U,[p.addReady?((0,s.Wz)(),(0,s.An)("form",{key:0,onSubmit:e[4]||(e[4]=(0,r.Y7)((t=>L.postReady()),["prevent"])),method:"post"},[(0,s.K2)($,{product:L.ledger.product,type:"ready",onFormData:L.handleFormData},null,8,["product","onFormData"]),(0,s.QD)("div",G,[(0,s.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[3]||(e[3]=(...t)=>L.showLedgerSummary&&L.showLedgerSummary(...t))}," Cancel "),H])],32)):(0,s.g1)("",!0),p.addDispatch?((0,s.Wz)(),(0,s.An)("form",{key:1,onSubmit:e[6]||(e[6]=(0,r.Y7)((t=>L.postDispatch()),["prevent"])),method:"post"},[(0,s.K2)($,{product:L.ledger.product,type:"dispatch",onFormData:L.handleFormData},null,8,["product","onFormData"]),(0,s.QD)("div",X,[(0,s.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[5]||(e[5]=(...t)=>L.showLedgerSummary&&L.showLedgerSummary(...t))}," Cancel "),Z])],32)):(0,s.g1)("",!0),p.addAdjustment?((0,s.Wz)(),(0,s.An)("form",{key:2,onSubmit:e[8]||(e[8]=(0,r.Y7)((t=>L.postAdjustment()),["prevent"])),method:"post"},[(0,s.K2)($,{product:L.ledger.product,type:"adjustment",onFormData:L.handleFormData},null,8,["product","onFormData"]),(0,s.QD)("div",tt,[(0,s.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[7]||(e[7]=(...t)=>L.showLedgerSummary&&L.showLedgerSummary(...t))}," Cancel "),et])],32)):(0,s.g1)("",!0)])])):(0,s.g1)("",!0),at,(0,s.K2)(P,{items:L.ledger.items},null,8,["items"])])}a(3248);var dt=a(8656),rt=a.n(dt),lt=a(8620),it=a(4424),nt=a(1708),ot={name:"LedgerDetailPage",components:{LedgerFilters:lt.c,LedgerInfo:it.c,LedgerForm:nt.c},data(){return{filters:[],formData:[],addReady:!1,addDispatch:!1,addAdjustment:!1,total:0,activePage:1,visibleLinks:[]}},watch:{"ledger.items":{immediate:!0,handler(){this.calculateVisibleLinks()}},activePage(){this.calculateVisibleLinks()}},created(){this.loadLedger("",!0)},mounted(){this.$store.dispatch("factory/setShowBottomNav",!0);const t=document.getElementById("ledgerImageModal");t&&t.addEventListener("show.bs.modal",(e=>{const a=e.relatedTarget,s=a.getAttribute("data-bs-url"),d=t.querySelector(".modal-dialog img");d.src=s}))},computed:{ledger(){return this.$store.getters["factory/ledger"]},filteredLedgerItems(){const t=new Date(this.filters.startDate),e=new Date(this.filters.endDate);return this.ledger.items.data.filter((a=>{const s=new Date(a.created_at);return s>=t&&s<=e}))},hasFilteredItems(){return this.filteredLedgerItems&&this.filteredLedgerItems.length>0}},methods:{calculateVisibleLinks(){if(!this.ledger.items||!this.ledger.items.links)return;const t=this.ledger.items.links.length-2;let e=Math.max(1,this.activePage-4),a=Math.min(t,this.activePage+3);t>8?a-e<7&&(1===e?a=8:a===t&&(e=t-7)):(e=1,a=t),this.visibleLinks=this.ledger.items.links.filter(((t,s)=>t.label.includes("Previous")||t.label.includes("Next")||s>=e&&s<=a))},loadLedger(t,e){this.activePage=1,e||(this.activePage=t.split("=")[1]),this.$store.dispatch("factory/fetchProductLedger",{ledger:this.$route.params.ledger,page:this.activePage})},showAddReady(){this.addAdjustment=!1,this.addDispatch=!1,this.addReady=!0},showAddDispatch(){this.addAdjustment=!1,this.addReady=!1,this.addDispatch=!0},showAddAdjustment(){this.addReady=!1,this.addDispatch=!1,this.addAdjustment=!0},showLedgerSummary(){this.addReady=!1,this.addDispatch=!1,this.addAdjustment=!1},getTableDataClass(t){switch(t.model){case"order":return this.filters.order?"text-start":"text-danger";case"ready":return this.filters.ready?"text-center":"text-danger";case"demand":return this.filters.demand?"text-end":"text-danger";case"adjustment":return this.againTry(t);default:return"text-end"}},againTry(t){switch(t.type){case"order":return this.filters.adjustment?"text-start":"text-danger";case"ready":return this.filters.adjustment?"text-center":"text-danger";case"demand":return this.filters.adjustment?"text-end":"text-danger"}},handleInput(t){t&&"object"===typeof t&&(void 0===t.quantity&&this.$set(t,"quantity",0),t.quantity=Math.max(0,t.quantity))},getActiveClass(t){return{"text-primary":"issued"===t.status,"text-warning":"cancelled"===t.status,"text-dark":"accepted"===t.status}},shouldShow(t){if("dispatch"===t.model)return!1;let e=this.filters[t.model];return"adjustment"===t.model?e&&this.filters[t.type]:e},calculateTotal(t){return this.ledger?.items?.data&&Array.isArray(this.ledger.items.data)&&this.filters[t]?this.ledger.items.data.reduce(((e,a)=>a.model===t?e+a.quantity:"adjustment"===a.model&&a.type===t&&this.filters["adjustment"]?e-a.quantity:e),0):0},formatDate(t){const e={weekday:"short",month:"short",day:"numeric"},a=new Date(t).toLocaleDateString("en-US",e);return a},postReady(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>{const a=this.ledger.product.ranges.filter((e=>{const a=`${t.sid}_${e.sid}`;return this.formData.ranges[a]})),s=a.length>0?Math.max(Math.ceil(this.formData.quantity[e]/a.length),1):0;return a.map((e=>{const a=`${t.sid}_${e.sid}`;return{[a]:s}}))})).flat();let e=0,a=[];if(t.forEach((t=>{const s=Object.keys(t)[0],d=t[s];d&&d>0&&(e+=d,a.push(t))})),e>this.ledger.readyable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.readyable_qty+" pcs.");const s={ledger_sid:this.ledger.sid,content:this.formData.content,expected_at:this.formData.date,quantities:JSON.stringify(a)};this.$store.dispatch("factory/postNewReady",s),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},postDispatch(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>{const a=this.ledger.product.ranges.filter((e=>{const a=`${t.sid}_${e.sid}`;return this.formData.ranges[a]})),s=a.length>0?Math.max(Math.ceil(this.formData.quantity[e]/a.length),1):0;return a.map((e=>{const a=`${t.sid}_${e.sid}`;return{[a]:s}}))})).flat();let e=0,a=[];if(t.forEach((t=>{const s=Object.keys(t)[0],d=t[s];d&&d>0&&(e+=d,a.push(t))})),console.log(e,this.ledger.dispatchable_qty),e>this.ledger.dispatchable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.dispatchable_qty+" pcs.");const s={ledger_sid:this.ledger.sid,content:this.formData.content,expected_at:this.formData.date,quantities:JSON.stringify(a)};this.$store.dispatch("factory/postNewDispatch",s),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},postAdjustment(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>{const a=this.ledger.product.ranges.filter((e=>this.formData.ranges[`${t.sid}_${e.sid}`]));let s=0;if(a.length>0){const t=parseInt(this.formData.quantity[e])||0;s=Math.max(Math.ceil(t/a.length),0)}return a.map((e=>{const a=`${t.sid}_${e.sid}`;return{[a]:s}}))})).flat();let e=0,a=[];if(t.forEach((t=>{const s=Object.keys(t)[0],d=t[s];d&&d>0&&(e+=d,a.push(t))})),"ready"===this.formData.adjtype&&e>this.ledger.demandable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.demandable_qty+" pcs.");const s={ledger_sid:this.ledger.sid,content:this.formData.content,type:this.formData.adjtype,expected_at:this.formData.date,tolerance:this.formData.tolerance,product:this.ledger.product.slug,quantities:JSON.stringify(a)};console.log(s),this.$store.dispatch("factory/postNewAdjustment",s),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},showQtyError(t,e){rt().fire({icon:"error",title:t,text:e})},handleFiltersChange(t){this.filters=t},handleFormData(t){this.formData=t.data,this.total=t.total}}},ct=a(4100);const ht=(0,ct.c)(ot,[["render",st],["__scopeId","data-v-2c464fec"]]);var ut=ht}}]);
//# sourceMappingURL=7436.c6169abc.js.map