"use strict";(self["webpackChunkwsgbrand_app_v1"]=self["webpackChunkwsgbrand_app_v1"]||[]).push([[136],{136:function(t,e,s){s.r(e),s.d(e,{default:function(){return pt}});var a=s(4108),d=s(9096),r=s(7764);const l=t=>((0,a.ED)("data-v-30f8a553"),t=t(),(0,a.ii)(),t),i={class:"font-title"},n={key:0,class:"border"},o={class:"table table-striped table-borderless mb-0",style:{"font-weight":"500"}},c=l((()=>(0,a.QD)("thead",null,[(0,a.QD)("tr",{class:"table-dark"},[(0,a.QD)("th",{class:"ps-3 fw-bold text-start"},"Date"),(0,a.QD)("th",{class:"fw-bold text-start"},"Order"),(0,a.QD)("th",{class:"fw-bold text-center"},"Ready"),(0,a.QD)("th",{class:"pe-3 fw-bold text-end"},"Demand")])],-1))),h={key:0},u=["data-bs-ledgermodelsid"],m={class:"ps-3 text-start"},g={key:1},p=l((()=>(0,a.QD)("td",{colspan:"4",class:"py-5 text-center"},[(0,a.QD)("span",null,"No data available based on current filter.")],-1))),b=[p],y={key:1},f={class:"table-dark"},D=l((()=>(0,a.QD)("td",{class:"ps-3 text-start fw-bold",style:{"min-width":"90px"}}," Total ",-1))),Q={class:"text-start",style:{"min-width":"90px"}},w={class:"text-center",style:{"min-width":"90px"}},x={class:"pe-3 text-end",style:{"min-width":"90px"}},k={key:0,"aria-label":"Page navigation"},A={class:"pagination"},v=["onClick"],L=l((()=>(0,a.QD)("i",{class:"bi bi-chevron-left"},null,-1))),_=[L],q=["onClick"],S=l((()=>(0,a.QD)("i",{class:"bi bi-chevron-right"},null,-1))),j=[S],W=["onClick"],C={class:"table table-striped table-borderless font-app"},F={class:"ps-2"},$=l((()=>(0,a.QD)("div",{class:"d-flex align-items-center"},[(0,a.QD)("i",{class:"pe-1 bi bi-plus fs-4 lh-1"}),(0,a.QD)("span",{style:{"margin-left":"-0.15rem"}},"Ready")],-1))),R=[$],z=l((()=>(0,a.QD)("span",{class:"ms-3"},"Order in Production",-1))),E={class:"pe-3 text-end"},I=l((()=>(0,a.QD)("span",{class:"smaller"},"pcs",-1))),P={class:"ps-2"},T=l((()=>(0,a.QD)("div",{class:"d-flex align-items-center"},[(0,a.QD)("i",{class:"pe-1 bi bi-plus fs-4 lh-1"}),(0,a.QD)("span",{style:{"margin-left":"-0.15rem"}},"Dispatch")],-1))),M=[T],N=l((()=>(0,a.QD)("span",{class:"ms-3"},"Demand Raised",-1))),O={class:"pe-3 text-end"},Y=l((()=>(0,a.QD)("span",{class:"smaller"},"pcs",-1))),K={class:"ps-2"},B=l((()=>(0,a.QD)("div",{class:"d-flex align-items-center"},[(0,a.QD)("i",{class:"pe-1 bi bi-plus fs-4 lh-1"}),(0,a.QD)("span",{style:{"margin-left":"-0.15rem"}},"Adjust")],-1))),J=[B],V=l((()=>(0,a.QD)("span",{class:"ms-3"},"Ledger Balance Qty",-1))),U={class:"pe-3 text-end"},G=l((()=>(0,a.QD)("span",{class:"smaller"},"pcs",-1))),H={key:1,class:"card mx-3 shadow"},X={class:"card-body"},Z={class:"btn-group w-100"},tt=l((()=>(0,a.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),et={class:"btn-group w-100"},st=l((()=>(0,a.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),at={class:"btn-group w-100"},dt=l((()=>(0,a.QD)("button",{class:"btn btn-sm btn-success fw-bold",type:"submit"}," Submit ",-1))),rt=l((()=>(0,a.QD)("div",{class:"modal fade",id:"ledgerImageModal",tabindex:"-1","aria-hidden":"true"},[(0,a.QD)("div",{class:"modal-dialog modal-fullscreen"},[(0,a.QD)("button",{type:"button",class:"btn h-100 w-100 p-0","data-bs-dismiss":"modal","aria-label":"Close"},[(0,a.QD)("img",{src:"https://placehold.co/400",class:"w-100",style:{"object-fit":"cover"}})])])],-1)));function lt(t,e,s,l,p,L){const S=(0,a.E1)("LedgerFilters"),$=(0,a.E1)("LedgerForm"),T=(0,a.E1)("LedgerInfo");return(0,a.Wz)(),(0,a.An)("div",i,[(0,a.K2)(S,{product:L.ledger.product,info:{label1:"Ready Done",label2:"Dispatch Done",value1:L.ledger.total_ready,value2:L.ledger.total_dispatch},onLedgerFiltersChanged:L.handleFiltersChange},null,8,["product","info","onLedgerFiltersChanged"]),p.addReady||p.addDispatch||p.addAdjustment?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.An)("div",n,[(0,a.QD)("table",o,[c,L.ledger.items&&L.ledger.items.data&&L.ledger.items.data.length?((0,a.Wz)(),(0,a.An)("tbody",h,[L.hasFilteredItems?((0,a.Wz)(!0),(0,a.An)(a.ae,{key:0},(0,a.mi)(L.filteredLedgerItems,((t,e)=>(0,a.wt)(((0,a.Wz)(),(0,a.An)("tr",{key:e,"data-bs-toggle":"offcanvas","data-bs-target":"#ledgerInfoModal","data-bs-ledgermodelsid":t.model_sid,"aria-controls":"ledgerInfoModal"},[(0,a.QD)("td",m,(0,d.WA)(L.formatDate(t.created_at)),1),(0,a.QD)("td",{colspan:"3",class:(0,d.WN)(["pe-3",[L.getTableDataClass(t),L.getActiveClass(t),{"text-danger":"adjustment"===t.model}]])},(0,d.WA)(t.quantity.toLocaleString()),3)],8,u)),[[r.Ub,L.shouldShow(t)]]))),128)):((0,a.Wz)(),(0,a.An)("tr",g,b))])):(0,a.g1)("",!0),L.ledger.items&&L.ledger.items.data&&L.ledger.items.data.length?((0,a.Wz)(),(0,a.An)("tfoot",y,[(0,a.QD)("tr",f,[D,(0,a.QD)("td",Q,(0,d.WA)(L.calculateTotalOrder("order",L.ledger.items.data,"accepted")),1),(0,a.QD)("td",w,(0,d.WA)(L.calculateTotal("ready").toLocaleString()),1),(0,a.QD)("td",x,(0,d.WA)(L.calculateTotal("demand").toLocaleString()),1)])])):(0,a.g1)("",!0)]),L.ledger.items&&L.ledger.items.data&&L.ledger.items.data.length?((0,a.Wz)(),(0,a.An)("nav",k,[(0,a.QD)("ul",A,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(p.visibleLinks,(t=>((0,a.Wz)(),(0,a.An)("li",{class:(0,d.WN)(["page-item flex-fill",{disabled:!t.url}]),key:t.label},[t.label.includes("Previous")?((0,a.Wz)(),(0,a.An)("a",{key:0,class:"page-link text-center text-dark",href:"#",onClick:(0,r.Y7)((e=>L.loadLedger(t.url)),["prevent"])},_,8,v)):t.label.includes("Next")?((0,a.Wz)(),(0,a.An)("a",{key:1,class:"page-link text-center text-dark",href:"#",onClick:(0,r.Y7)((e=>L.loadLedger(t.url)),["prevent"])},j,8,q)):((0,a.Wz)(),(0,a.An)("a",{key:2,href:"#",class:(0,d.WN)([{"text-primary fw-bold":this.activePage==t.label,"text-dark":this.activePage!=t.label},"page-link text-center"]),onClick:(0,r.Y7)((e=>L.loadLedger(t.url)),["prevent"])},(0,d.WA)(t.label),11,W))],2)))),128))])])):(0,a.g1)("",!0)])),(0,a.QD)("table",C,[(0,a.QD)("tbody",null,[(0,a.QD)("tr",null,[(0,a.QD)("td",F,[(0,a.QD)("button",{class:"text-start btn btn-sm btn-dark px-1 w-90p",onClick:e[0]||(e[0]=(...t)=>L.showAddReady&&L.showAddReady(...t))},R),z]),(0,a.QD)("td",E,[(0,a.mY)((0,d.WA)(L.ledger.readyable_qty?L.ledger.readyable_qty.toLocaleString():0)+" ",1),I])]),(0,a.QD)("tr",null,[(0,a.QD)("td",P,[(0,a.QD)("button",{class:"text-start btn btn-sm btn-dark px-1 w-90p",onClick:e[1]||(e[1]=(...t)=>L.showAddDispatch&&L.showAddDispatch(...t))},M),N]),(0,a.QD)("td",O,[(0,a.mY)((0,d.WA)(L.ledger.dispatchable_qty?L.ledger.dispatchable_qty.toLocaleString():0)+" ",1),Y])]),(0,a.QD)("tr",null,[(0,a.QD)("td",K,[(0,a.QD)("button",{class:"text-start btn btn-sm btn-dark px-1 w-90p",onClick:e[2]||(e[2]=(...t)=>L.showAddAdjustment&&L.showAddAdjustment(...t))},J),V]),(0,a.QD)("td",U,[(0,a.mY)((0,d.WA)(L.ledger.balance_qty?L.ledger.balance_qty.toLocaleString():0)+" ",1),G])])])]),p.addReady||p.addDispatch||p.addAdjustment?((0,a.Wz)(),(0,a.An)("div",H,[(0,a.QD)("div",X,[p.addReady?((0,a.Wz)(),(0,a.An)("form",{key:0,onSubmit:e[4]||(e[4]=(0,r.Y7)((t=>L.postReady()),["prevent"])),method:"post"},[(0,a.K2)($,{product:L.ledger.product,type:"ready",onFormData:L.handleFormData},null,8,["product","onFormData"]),(0,a.QD)("div",Z,[(0,a.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[3]||(e[3]=(...t)=>L.showLedgerSummary&&L.showLedgerSummary(...t))}," Cancel "),tt])],32)):(0,a.g1)("",!0),p.addDispatch?((0,a.Wz)(),(0,a.An)("form",{key:1,onSubmit:e[6]||(e[6]=(0,r.Y7)((t=>L.postDispatch()),["prevent"])),method:"post"},[(0,a.K2)($,{product:L.ledger.product,type:"dispatch",onFormData:L.handleFormData},null,8,["product","onFormData"]),(0,a.QD)("div",et,[(0,a.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[5]||(e[5]=(...t)=>L.showLedgerSummary&&L.showLedgerSummary(...t))}," Cancel "),st])],32)):(0,a.g1)("",!0),p.addAdjustment?((0,a.Wz)(),(0,a.An)("form",{key:2,onSubmit:e[8]||(e[8]=(0,r.Y7)((t=>L.postAdjustment()),["prevent"])),method:"post"},[(0,a.K2)($,{product:L.ledger.product,ledger:L.ledger,type:"adjustment",onFormData:L.handleFormData},null,8,["product","ledger","onFormData"]),(0,a.QD)("div",at,[(0,a.QD)("button",{class:"btn btn-sm btn-outline-dark fw-bold",type:"button",onClick:e[7]||(e[7]=(...t)=>L.showLedgerSummary&&L.showLedgerSummary(...t))}," Cancel "),dt])],32)):(0,a.g1)("",!0)])])):(0,a.g1)("",!0),rt,(0,a.K2)(T,{items:L.ledger.items},null,8,["items"])])}s(3248);var it=s(8656),nt=s.n(it),ot=s(5456),ct=s(4424),ht=s(6878),ut={name:"LedgerDetailPage",components:{LedgerFilters:ot.c,LedgerInfo:ct.c,LedgerForm:ht.c},data(){return{filters:[],formData:[],addReady:!1,addDispatch:!1,addAdjustment:!1,total:0,activePage:1,visibleLinks:[]}},watch:{"ledger.items":{immediate:!0,handler(){this.calculateVisibleLinks()}},activePage(){this.calculateVisibleLinks()}},created(){this.loadLedger("",!0)},mounted(){this.$store.dispatch("factory/setShowBottomNav",!0);const t=document.getElementById("ledgerImageModal");t&&t.addEventListener("show.bs.modal",(e=>{const s=e.relatedTarget,a=s.getAttribute("data-bs-url"),d=t.querySelector(".modal-dialog img");d.src=a}))},computed:{ledger(){return this.$store.getters["factory/ledger"]},filteredLedgerItems(){const t=new Date(this.filters.startDate),e=new Date(this.filters.endDate);return this.ledger.items.data.filter((s=>{const a=new Date(s.created_on);return a>=t&&a<=e}))},hasFilteredItems(){return this.filteredLedgerItems&&this.filteredLedgerItems.length>0}},methods:{calculateVisibleLinks(){if(!this.ledger.items||!this.ledger.items.links)return;const t=this.ledger.items.links.length-2;let e=Math.max(1,this.activePage-4),s=Math.min(t,this.activePage+3);t>8?s-e<7&&(1===e?s=8:s===t&&(e=t-7)):(e=1,s=t),this.visibleLinks=this.ledger.items.links.filter(((t,a)=>t.label.includes("Previous")||t.label.includes("Next")||a>=e&&a<=s))},loadLedger(t,e){this.activePage=1,e||(this.activePage=t.split("=")[1]),this.$store.dispatch("factory/fetchProductLedger",{ledger:this.$route.params.ledger,page:this.activePage})},showAddReady(){this.addAdjustment=!1,this.addDispatch=!1,this.addReady=!0},showAddDispatch(){this.addAdjustment=!1,this.addReady=!1,this.addDispatch=!0},showAddAdjustment(){this.addReady=!1,this.addDispatch=!1,this.addAdjustment=!0},showLedgerSummary(){this.addReady=!1,this.addDispatch=!1,this.addAdjustment=!1},getTableDataClass(t){switch(t.model){case"order":return this.filters.order?"text-start":"text-danger";case"ready":return this.filters.ready?"text-center":"text-danger";case"demand":return this.filters.demand?"text-end":"text-danger";case"adjustment":return this.againTry(t);default:return"text-end"}},againTry(t){switch(t.type){case"order":return this.filters.adjustment?"text-start":"text-danger";case"ready":return this.filters.adjustment?"text-center":"text-danger";case"demand":return this.filters.adjustment?"text-end":"text-danger"}},handleInput(t){t&&"object"===typeof t&&(void 0===t.quantity&&this.$set(t,"quantity",0),t.quantity=Math.max(0,t.quantity))},getActiveClass(t){return{"text-primary":"issued"===t.status,"text-warning":"cancelled"===t.status,"text-dark":"accepted"===t.status}},shouldShow(t){if("dispatch"===t.model)return!1;let e=this.filters[t.model];return"adjustment"===t.model?e&&this.filters[t.type]:e},calculateTotal(t){return this.ledger?.items?.data&&Array.isArray(this.ledger.items.data)&&this.filters[t]?this.ledger.items.data.reduce(((e,s)=>s.model===t?e+s.quantity:"adjustment"===s.model&&s.type===t&&this.filters["adjustment"]?e-s.quantity:e),0):0},calculateTotalOrder(t,e,s){if(e&&Array.isArray(e)){const a=e.filter((e=>e.model===t&&this.filters[t]&&e.status===s));return a.reduce(((t,e)=>t+e.quantity),0)}return 0},formatDate(t){const e={weekday:"short",month:"short",day:"numeric"},s=new Date(t).toLocaleDateString("en-US",e);return s},postReady(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>{const s=this.ledger.product.ranges.filter((e=>{const s=`${t.sid}_${e.sid}`;return this.formData.ranges[s]})),a=s.length>0?Math.max(Math.ceil(this.formData.quantity[e]/s.length),1):0;return s.map((e=>{const s=`${t.sid}_${e.sid}`;return{[s]:a}}))})).flat();let e=0,s=[];if(t.forEach((t=>{const a=Object.keys(t)[0],d=t[a];d&&d>0&&(e+=d,s.push(t))})),e>this.ledger.readyable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.readyable_qty+" pcs.");const a={ledger_sid:this.ledger.sid,content:this.formData.content,expected_at:this.formData.date,quantities:JSON.stringify(s)};this.$store.dispatch("factory/postNewReady",a),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},postDispatch(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>{const s=this.ledger.product.ranges.filter((e=>{const s=`${t.sid}_${e.sid}`;return this.formData.ranges[s]})),a=s.length>0?Math.max(Math.ceil(this.formData.quantity[e]/s.length),1):0;return s.map((e=>{const s=`${t.sid}_${e.sid}`;return{[s]:a}}))})).flat();let e=0,s=[];if(t.forEach((t=>{const a=Object.keys(t)[0],d=t[a];d&&d>0&&(e+=d,s.push(t))})),console.log(e,this.ledger.dispatchable_qty),e>this.ledger.dispatchable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.dispatchable_qty+" pcs.");const a={ledger_sid:this.ledger.sid,content:this.formData.content,expected_at:this.formData.date,quantities:JSON.stringify(s)};this.$store.dispatch("factory/postNewDispatch",a),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},postAdjustment(){if(this.ledger.product.options&&this.total>0){const t=this.ledger.product.options.map(((t,e)=>{const s=this.ledger.product.ranges.filter((e=>this.formData.ranges[`${t.sid}_${e.sid}`]));let a=0;if(s.length>0){const t=parseInt(this.formData.quantity[e])||0;a=Math.max(Math.ceil(t/s.length),0)}return s.map((e=>{const s=`${t.sid}_${e.sid}`;return{[s]:a}}))})).flat();let e=0,s=[];if(t.forEach((t=>{const a=Object.keys(t)[0],d=t[a];d&&d>0&&(e+=d,s.push(t))})),"ready"===this.formData.adjtype&&e>this.ledger.demandable_qty)return void this.showQtyError("Quantity Error","Total quantity should not exceed "+this.ledger.demandable_qty+" pcs.");const a={ledger_sid:this.ledger.sid,content:this.formData.content,type:this.formData.adjtype,expected_at:this.formData.date,tolerance:this.formData.tolerance,product:this.ledger.product.slug,quantities:JSON.stringify(s)};console.log(a),this.$store.dispatch("factory/postNewAdjustment",a),this.showLedgerSummary()}else console.log("Quantity total is 0 or less, or ledger is empty. Skipping post request.")},showQtyError(t,e){nt().fire({icon:"error",title:t,text:e})},handleFiltersChange(t){this.filters=t},handleFormData(t){this.formData=t.data,this.total=t.total}}},mt=s(4100);const gt=(0,mt.c)(ut,[["render",lt],["__scopeId","data-v-30f8a553"]]);var pt=gt}}]);
//# sourceMappingURL=136.586985fc.js.map